#!/usr/bin/env python3

"""Autogenerated TDF decoding logic"""

import ctypes

from infuse_iot.generated.tdf_base import TdfStructBase, TdfReadingBase


class structs:
{% for name, info in structs.items() %}
    class {{ name }}(TdfStructBase):
        """{{ info['description'] }}"""

        _fields_ = [
{% for field in info['fields'] %}
            ("{{ field['py_name'] }}", {{ field['py_type'] }}),
{% endfor %}
        ]
        _pack_ = 1
        _postfix_ = {
{% for fmt in info['displays'] %}
            "{{ fmt['name'] }}": {{ fmt['postfix'] }},
{% endfor %}
        }
        _display_fmt_ = {
{% for fmt in info['displays'] %}
            "{{ fmt['name'] }}": {{ fmt['fmt'] }},
{% endfor %}
        }
{% for conv in info['conversions'] %}

        @property
        def {{ conv['name'] }}(self):
            return self._{{ conv['name'] }}{{ conv['conv']}}
{% endfor %}

{% endfor %}
class readings:
{% for tdf_id, info in definitions.items() %}
    class {{ info['name'] | lower }}(TdfReadingBase):
        """{{ info['description'] }}"""

        name = "{{ info['name'] }}"
        _fields_ = [
{% for field in info['fields'] %}
            ("{{ field['py_name'] }}", {{ field['py_type'] }}),
{% endfor %}
        ]
        _pack_ = 1
        _postfix_ = {
{% for fmt in info['displays'] %}
            "{{ fmt['name'] }}": {{ fmt['postfix'] }},
{% endfor %}
        }
        _display_fmt_ = {
{% for fmt in info['displays'] %}
            "{{ fmt['name'] }}": {{ fmt['fmt'] }},
{% endfor %}
        }
{% for conv in info['conversions'] %}

        @property
        def {{ conv['name'] }}(self):
            return self._{{ conv['name'] }}{{ conv['conv']}}
{% endfor %}

{% endfor %}
id_type_mapping = {
{% for tdf_id, info in definitions.items() %}
    {{ tdf_id }}: readings.{{ info['name'] | lower }},
{% endfor %}
}
