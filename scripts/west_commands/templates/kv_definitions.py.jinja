#!/usr/bin/env python3
# mypy: ignore-errors

"""Autogenerated KV store definitions"""

import ctypes

from infuse_iot.util.ctypes import VLACompatLittleEndianStruct

class structs:
{% for name, info in structs.items() %}
    class {{ name }}(VLACompatLittleEndianStruct):
        """{{ info['description'] }}"""

        _fields_ = [
{% for field in info['fields'] %}
{% if field['num'] == 0 %}
{% if info['fields']|length == 1 %}
            ("{{ field['name'] }}_num", ctypes.c_uint8),
{% endif %}
{% else %}
            ("{{ field['name'] }}", {{ field['py_type'] }}),
{% endif %}
{% endfor %}
        ]
{% if 'flexible' in info %}
        vla_field = ("{{ info['fields'][-1]['name'] }}", {{ info['fields'][-1]['py_type'] }})
{% endif %}
        _pack_ = 1

{% endfor %}

class slots:
{% for base_id, info in definitions.items() %}
    class {{ info['name'] | lower }}(VLACompatLittleEndianStruct):
        """{{ info['description'] }}"""

        NAME = "{{ info['name'] }}"
        BASE_ID = {{ base_id }}
        RANGE = {{ info.get('range', 1) }}
        _fields_ = [
{% for field in info['fields'] %}
{% if 'flexible' in info %}
{% if info['num'] == 0 %}
{% if info['fields']|length == 1 %}
            ("{{ field['name'] }}_num", ctypes.c_uint8),
{% endif %}
{% endif %}
{% else %}
            ("{{ field['name'] }}", {{ field['py_type'] }}),
{% endif %}
{% endfor %}
        ]
{% if 'flexible' in info %}
        vla_field = ("{{ info['fields'][-1]['name'] }}", {{ info['fields'][-1]['py_type'] }})
{% endif %}
        _pack_ = 1

{% endfor %}
    ID_MAPPING = {
{% for base_id, info in definitions.items() %}
{% for idx in range(info.get('range', 1)) %}
        {{ base_id + idx }}: {{ info['name'] | lower }},
{% endfor %}
{% endfor %}
    }
