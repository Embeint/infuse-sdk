/**
 * @file
 * @brief Register defines
 * @copyright 2025 Embeint Holdings Pty Ltd
 * @author Jordan Yates <jordan@embeint.com>
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

#ifndef INFUSE_SDK_DRIVERS_LED_LP581X_H_
#define INFUSE_SDK_DRIVERS_LED_LP581X_H_

#include <zephyr/sys/util.h>

#ifdef __cplusplus
extern "C" {
#endif

/** Output current limits in 0.1 mA */
#define LP581X_MAX_CURRENT_SETTING 255

enum lp581x_regs {
	LP581X_REG_CHIP_EN = 0x00,
	LP581X_REG_DEV_CONFIG0 = 0x01,
	LP581X_REG_DEV_CONFIG1 = 0x02,
	LP581X_REG_DEV_CONFIG2 = 0x03,
	LP581X_REG_DEV_CONFIG3 = 0x04,
	LP581X_REG_DEV_CONFIG4 = 0x05,
	LP581X_REG_ENGINE_CONFIG0 = 0x06,
	LP581X_REG_ENGINE_CONFIG1 = 0x07,
	LP581X_REG_ENGINE_CONFIG2 = 0x08,
	LP581X_REG_ENGINE_CONFIG3 = 0x09,
	LP581X_REG_ENGINE_CONFIG4 = 0x0A,
	LP581X_REG_ENGINE_CONFIG5 = 0x0B,
	LP581X_REG_ENGINE_CONFIG6 = 0x0C,
	LP581X_REG_SHUTDOWN_CMD = 0x0D,
	LP581X_REG_RESET_CMD = 0x0E,
	LP581X_REG_UPDATE_CMD = 0x0F,
	LP581X_REG_START_CMD = 0x10,
	LP581X_REG_STOP_CMD = 0x11,
	LP581X_REG_PAUSE_CONTINUE = 0x12,
	LP581X_REG_FLAG_CLR = 0x13,
	LP581X_REG_OUT0_DC = 0x14,
	LP581X_REG_OUT1_DC = 0x15,
	LP581X_REG_OUT2_DC = 0x16,
	LP581X_REG_OUT3_DC = 0x16,
	LP581X_REG_OUT0_MANUAL_PWM = 0x18,
	LP581X_REG_OUT1_MANUAL_PWM = 0x19,
	LP581X_REG_OUT2_MANUAL_PWM = 0x1A,
	LP581X_REG_OUT3_MANUAL_PWM = 0x1B,
	LP581X_REG_PATTERN0_BASE = 0x1C,
	LP581X_REG_PATTERN1_BASE = 0x25,
	LP581X_REG_PATTERN2_BASE = 0x2E,
	LP581X_REG_PATTERN3_BASE = 0x37,
	LP581X_REG_FLAG = 0x40,
};

enum {
	LP581X_CHIP_EN_CHIP_ENABLE = BIT(0),
	LP581X_CHIP_EN_CHIP_DISABLE = 0x00,
	LP581X_CHIP_EN_INSTABLINK_ENABLE = 0x00,
	LP581X_CHIP_EN_INSTABLINK_DISABLE = BIT(1),
};

enum {
	LP581X_CONFIG1_OUT0_EN = BIT(0),
	LP581X_CONFIG1_OUT1_EN = BIT(1),
	LP581X_CONFIG1_OUT2_EN = BIT(2),
	LP581X_CONFIG1_OUT3_EN = BIT(3),
};

enum {
	LP581X_CONFIG2_OUT0_FADE_EN = BIT(0),
	LP581X_CONFIG2_OUT1_FADE_EN = BIT(1),
	LP581X_CONFIG2_OUT2_FADE_EN = BIT(2),
	LP581X_CONFIG2_OUT3_FADE_EN = BIT(3),
};

enum {
	LP581X_CONFIG3_OUT0_AUTO_EN = BIT(0),
	LP581X_CONFIG3_OUT1_AUTO_EN = BIT(1),
	LP581X_CONFIG3_OUT2_AUTO_EN = BIT(2),
	LP581X_CONFIG3_OUT3_AUTO_EN = BIT(3),
	LP581X_CONFIG3_OUT0_EXP_EN = BIT(4),
	LP581X_CONFIG3_OUT1_EXP_EN = BIT(5),
	LP581X_CONFIG3_OUT2_EXP_EN = BIT(6),
	LP581X_CONFIG3_OUT3_EXP_EN = BIT(7),
};

enum {
	LP581X_FLAG_CLR_POR = BIT(0),
	LP581X_FLAG_CLR_TSD = BIT(1),
};

enum {
	LP581X_FLAG_POR = BIT(0),
	LP581X_FLAG_TSD = BIT(1),
	LP581X_FLAG_ENGINE_BUSY = BIT(2),
	LP581X_FLAG_OUT0_ENGINE_BUSY = BIT(3),
	LP581X_FLAG_OUT1_ENGINE_BUSY = BIT(4),
	LP581X_FLAG_OUT2_ENGINE_BUSY = BIT(5),
	LP581X_FLAG_OUT3_ENGINE_BUSY = BIT(6),
};

#define LP581X_SHUTDOWN_CMD 0x33
#define LP581X_RESET_CMD    0xCC
#define LP581X_UPDATE_CMD   0x55
#define LP581X_START_CMD    0xFF
#define LP581X_STOP_CMD     0xAA
#define LP581X_PAUSE_CMD    0x01
#define LP581X_CONTINUE_CMD 0x00

struct lp581x_pattern_regs {
	/* PAUSE T0 in upper bits, PAUSE T1 in lower bits */
	uint8_t pause_time;
	/* Play times in lower bits */
	uint8_t play_count;
	/* PWM values */
	uint8_t pwm[5];
	/* SLOPER T1 in upper bits, SLOPER T0 in lower bits */
	uint8_t sloper1;
	/* SLOPER T3 in upper bits, SLOPER T2 in lower bits */
	uint8_t sloper2;
} __packed;

#ifdef __cplusplus
}
#endif

#endif /* INFUSE_SDK_DRIVERS_LED_LP581X_H_ */
