common:
  tags: infuse net
  min_flash: 64
  min_ram: 32
tests:
  net.auto_sntp.triggered.native.sync:
    platform_allow:
      - native_sim
    integration_platforms:
      - native_sim
    extra_configs:
      - CONFIG_NATIVE_SIM_SLOWDOWN_TO_REAL_TIME=y
      - CONFIG_INFUSE_DNS_ASYNC=n
      - CONFIG_SNTP_AUTO_LOG_LEVEL_DBG=y
    extra_args:
      - OVERLAY_CONFIG="overlay-nsos.conf"
    harness: console
    harness_config:
      type: multi_line
      ordered: true
      regex:
        - "SNTP query already running"
        - "time.cloudflare.com -> (.*)"
        - "Sending request..."
        - "Unix time: (.*)"
        - "Now: (.*) UTC"
        - "Ref: (.*) UTC"
        - "Using cached SNTP address"
        - "Sending request..."
        - "Unix time: (.*)"
        - "Now: (.*) UTC"
        - "Ref: (.*) UTC"
  net.auto_sntp.triggered.native.async:
    platform_allow:
      - native_sim
    integration_platforms:
      - native_sim
    extra_configs:
      - CONFIG_NATIVE_SIM_SLOWDOWN_TO_REAL_TIME=y
      - CONFIG_INFUSE_DNS_ASYNC=y
      - CONFIG_SNTP_AUTO_LOG_LEVEL_DBG=y
    extra_args:
      - OVERLAY_CONFIG="overlay-nsos.conf"
    harness: console
    harness_config:
      type: multi_line
      ordered: true
      regex:
        - "SNTP query already running"
        - "/?/?/? -> (.*)"
        - "Sending request..."
        - "Unix time: (.*)"
        - "Now: (.*) UTC"
        - "Ref: (.*) UTC"
        - "Using cached SNTP address"
        - "Sending request..."
        - "Unix time: (.*)"
        - "Now: (.*) UTC"
        - "Ref: (.*) UTC"
