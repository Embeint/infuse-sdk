# ePacket configuration

menuconfig EPACKET
	bool "ePacket subsystem"
	depends on NET_BUF
	select INFUSE_WORKQ
	select POLL

if EPACKET

module = EPACKET
module-str = epacket
source "subsys/logging/Kconfig.template.log_config"

config EPACKET_KEYS_EXTENSION_NETWORKS
	int "Number of alternate network keys that can be loaded for decoding"
	default 0
	help
	  This option controls how many alternate base network keys can be added
	  into the key module with epacket_key_network_add for decoding. May
	  require increasing MBEDTLS_PSA_KEY_SLOT_COUNT.

config EPACKET_PROCESS_THREAD_SPLIT
	bool "Dedicated threads for TX and RX packet processing"

config EPACKET_PROCESS_THREAD_STACK_SIZE
	int "Size of the stack for the thread that processes ePacket frames"
	default 4096 if COVERAGE
	default 2048

config EPACKET_INFUSE_WATCHDOG
	bool "Install watchdog on the ePacket processing thread"
	depends on INFUSE_WATCHDOG
	default y

config EPACKET_BUFFER_EXHAUSTION_TIMEOUT
	int "Timeout for detecting ePacket buffer exhaustion"
	default 60
	help
		If all buffers (TX or RX) have been claimed from the pool, require that
		at least one buffer is returned within this duration. This detects all
		buffers being held by contexts that wouldn't otherwise trigger a watchdog
		timeout.

config EPACKET_BUFFERS_TX
	int "Number of ePacket buffers for TX"
	range 1 16
	default 3

config EPACKET_BUFFERS_RX
	int "Number of ePacket buffers for RX"
	range 1 16
	default 3

config EPACKET_RATE_LIMIT_BUFFER_THRESHOLD
	int "Send a rate limit request when number of free TX buffers reaches this value"
	default 1

config EPACKET_RATE_LIMIT_REQ_DURATION_MS
	int "Duration of the rate limit request delays when running out of TX buffers"
	range 1 255
	default 100
	help
	  When forwarding packets, the gateway handler will automatically request connected
	  devices to pause transmissions for a short duration if it faces buffer starvation.
	  This option controls the duration of the requested pause, and can be tuned based on
	  how quickly the backhaul interface can free buffers.

config EPACKET_RECEIVE_GROUPING
	bool "Append multiple received packets into a single INFUSE_RECEIVED_EPACKET"

config EPACKET_RECEIVE_GROUPING_MAX_HOLD_MS
	int "Maximum duration to hold a INFUSE_RECEIVED_EPACKET waiting for more packets"
	depends on EPACKET_RECEIVE_GROUPING
	default 1000

config EPACKET_FORWARDING
	bool "Support for handling ePacket forwarding packets"
	depends on EPACKET_INTERFACE_BT_CENTRAL

config EPACKET_PACKET_SIZE_MAX
	int "Maximum supported ePacket packet size"
	range 64 2048
	default 555 if EPACKET_INTERFACE_SERIAL
	default 548 if NET_IPV4
	default 256
	help
	  512 byte serial payload + overhead = 555
	  IPv4 minimum MTU = 576 (28 byte IP + UDP header)
	  256 is sufficient for Bluetooth only devices.

config EPACKET_BUFFERS_TX_DELAYABLE_WORK
	bool
	help
	  Enable a per TX buffer delayable work item.

config EPACKET_FILTERING
	bool "ePacket filtering functions"
	depends on TDF

rsource "interfaces/Kconfig"

endif # EPACKET

config EPACKET_CRYPTO
	bool
	depends on INFUSE_SECURITY
	default y
